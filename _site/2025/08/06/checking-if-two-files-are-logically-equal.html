<!DOCTYPE html><html lang="en" ><head><title>Ovidiu Pârvu | Checking if two files are logically equal</title><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><style> *,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}body{font-family:system-ui,sans-serif;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;line-height:1.5;font-size:1rem;color:#16171a}nav ul{border-right:1px solid #edf2f7}a{text-decoration:underline}pre{margin:.5rem 0;padding:.5rem}.post p{margin:.5rem 0}.post h1,.post h2,.post h3,.post h4{margin:1rem 0}.post h2:first-child,.project h2:first-child,.photo h2:first-child{margin-top:0}.meta{margin:2rem 0}code,pre{background:#ecedee}code{padding:.1rem}pre code{border:none}pre{padding:1rem;overflow-x:auto}img{max-width:100%}hr{background:#000;height:1px;border:0}header{flex-basis:7rem;flex-grow:1;position:relative}header a{text-decoration:none}header li{margin-bottom:.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem}blockquote{font-style:italic;border-left:5px solid #ececec;padding-left:1rem}h1,h2,h3,h4,h5{line-height:1;margin:1rem 0;font-weight:600}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:.5rem}.posts ul,header ul{list-style:none}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}.post ul,.project ul,.post ol{list-style-position:inside}.post ul li,.project ul li,.post ol li{padding-left:1rem}main{display:flex;flex-wrap:wrap;max-width:70rem;margin:2rem auto;padding:1rem}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #edf2f7;padding-bottom:2rem}nav ul{border-right:0px}.photos ul{margin-top:.5rem}}section{flex-basis:0;flex-grow:999;min-width:70%;display:flex;flex-direction:column}figcaption{font-size:smaller}.highlight table td{padding:5px}.highlight table pre{margin:0}.highlight,.highlight .w{color:#24292f}.highlight .k,.highlight .kd,.highlight .kn,.highlight .kp,.highlight .kr,.highlight .kt,.highlight .kv{color:#cf222e}.highlight .gr{color:#f6f8fa}.highlight .gd{color:#82071e;background-color:#ffebe9}.highlight .nb{color:#953800}.highlight .nc{color:#953800}.highlight .no{color:#953800}.highlight .nn{color:#953800}.highlight .sr{color:#116329}.highlight .na{color:#116329}.highlight .nt{color:#116329}.highlight .gi{color:#116329;background-color:#dafbe1}.highlight .ges{font-weight:bold;font-style:italic}.highlight .kc{color:#0550ae}.highlight .l,.highlight .ld,.highlight .m,.highlight .mb,.highlight .mf,.highlight .mh,.highlight .mi,.highlight .il,.highlight .mo,.highlight .mx{color:#0550ae}.highlight .sb{color:#0550ae}.highlight .bp{color:#0550ae}.highlight .ne{color:#0550ae}.highlight .nl{color:#0550ae}.highlight .py{color:#0550ae}.highlight .nv,.highlight .vc,.highlight .vg,.highlight .vi,.highlight .vm{color:#0550ae}.highlight .o,.highlight .ow{color:#0550ae}.highlight .gh{color:#0550ae;font-weight:bold}.highlight .gu{color:#0550ae;font-weight:bold}.highlight .s,.highlight .sa,.highlight .sc,.highlight .dl,.highlight .sd,.highlight .s2,.highlight .se,.highlight .sh,.highlight .sx,.highlight .s1,.highlight .ss{color:#0a3069}.highlight .nd{color:#8250df}.highlight .nf,.highlight .fm{color:#8250df}.highlight .err{color:#f6f8fa;background-color:#82071e}.highlight .c,.highlight .ch,.highlight .cd,.highlight .cm,.highlight .cp,.highlight .cpf,.highlight .c1,.highlight .cs{color:#6e7781}.highlight .gl{color:#6e7781}.highlight .gt{color:#6e7781}.highlight .ni{color:#24292f}.highlight .si{color:#24292f}.highlight .ge{color:#24292f;font-style:italic}.highlight .gs{color:#24292f;font-weight:bold}</style><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Ovidiu Pârvu | Technical blog" /><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Checking if two files are logically equal" /><meta name="author" content="Ovidiu Pârvu" /><meta property="og:locale" content="en_US" /><meta name="description" content="For some use cases it is useful to be able to determine if two files are logically equal, namely they have the same extension and contents but their metadata can differ." /><meta property="og:description" content="For some use cases it is useful to be able to determine if two files are logically equal, namely they have the same extension and contents but their metadata can differ." /><link rel="canonical" href="http://localhost:4000/2025/08/06/checking-if-two-files-are-logically-equal" /><meta property="og:url" content="http://localhost:4000/2025/08/06/checking-if-two-files-are-logically-equal" /><meta property="og:site_name" content="Ovidiu Pârvu Technical blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-08-06T00:00:00+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Checking if two files are logically equal" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Ovidiu Pârvu"},"dateModified":"2025-08-06T00:00:00+01:00","datePublished":"2025-08-06T00:00:00+01:00","description":"For some use cases it is useful to be able to determine if two files are logically equal, namely they have the same extension and contents but their metadata can differ.","headline":"Checking if two files are logically equal","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2025/08/06/checking-if-two-files-are-logically-equal"},"url":"http://localhost:4000/2025/08/06/checking-if-two-files-are-logically-equal"}</script> <script> MathJax = { tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']] } }; </script> <script id="MathJax-script" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/4.0.0/tex-mml-chtml.min.js"> </script></head><body><main role="main"><header role="banner"><nav role="navigation"><ul><li><a href="/" >Blog</a></li><li><a href="/search" >Search</a></li><li><a href="/about" >About</a></li></ul></nav></header><section class="post"><h2>Checking if two files are logically equal</h2><p>For some use cases it is useful to be able to determine if two files are logically equal, namely they have the same extension and contents but their metadata can differ.</p><p>One approach for checking if two files are logically equal in Python, with metadata exclusion/ignore support for csv and Parquet files, is given <a href="https://github.com/ovidiuparvu/compare-files-logically">here</a> and shown below.</p><div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">filecmp</span>
<span class="kn">from</span> <span class="n">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="n">typing</span> <span class="kn">import</span> <span class="n">TypeAlias</span>

<span class="kn">import</span> <span class="n">polars</span> <span class="k">as</span> <span class="n">pl</span>

<span class="n">FilePath</span><span class="p">:</span> <span class="n">TypeAlias</span> <span class="o">=</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span>


<span class="k">def</span> <span class="nf">ensure_existing_file_path</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="n">FilePath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
    <span class="n">path</span> <span class="o">=</span> <span class="nc">Path</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span> <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="n">file_path</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="p">.</span><span class="nf">exists</span><span class="p">()</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">path</span><span class="p">.</span><span class="nf">is_file</span><span class="p">():</span>
        <span class="k">raise</span> <span class="nc">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s"> should point to an existing file and it does not.</span><span class="sh">"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">path</span>


<span class="k">def</span> <span class="nf">files_are_logically_equal</span><span class="p">(</span><span class="n">file1</span><span class="p">:</span> <span class="n">FilePath</span><span class="p">,</span> <span class="n">file2</span><span class="p">:</span> <span class="n">FilePath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="n">path1</span> <span class="o">=</span> <span class="nf">ensure_existing_file_path</span><span class="p">(</span><span class="n">file1</span><span class="p">)</span>
    <span class="n">path2</span> <span class="o">=</span> <span class="nf">ensure_existing_file_path</span><span class="p">(</span><span class="n">file2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">path1</span><span class="p">.</span><span class="nf">samefile</span><span class="p">(</span><span class="n">path2</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>
    
    <span class="k">if</span> <span class="n">path1</span><span class="p">.</span><span class="nf">stat</span><span class="p">().</span><span class="n">st_size</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">path2</span><span class="p">.</span><span class="nf">stat</span><span class="p">().</span><span class="n">st_size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>
    
    <span class="n">ext1</span> <span class="o">=</span> <span class="n">path1</span><span class="p">.</span><span class="n">suffix</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span>
    <span class="n">ext2</span> <span class="o">=</span> <span class="n">path2</span><span class="p">.</span><span class="n">suffix</span><span class="p">.</span><span class="nf">lower</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">ext1</span> <span class="o">!=</span> <span class="n">ext2</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    
    <span class="k">match</span> <span class="n">ext1</span><span class="p">:</span>
        <span class="k">case</span> <span class="sh">'</span><span class="s">.csv</span><span class="sh">'</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pl</span><span class="p">.</span><span class="nf">scan_csv</span><span class="p">(</span><span class="n">path1</span><span class="p">).</span><span class="nf">collect</span><span class="p">(</span><span class="n">engine</span><span class="o">=</span><span class="sh">"</span><span class="s">streaming</span><span class="sh">"</span><span class="p">).</span><span class="nf">equals</span><span class="p">(</span><span class="n">pl</span><span class="p">.</span><span class="nf">scan_csv</span><span class="p">(</span><span class="n">path2</span><span class="p">).</span><span class="nf">collect</span><span class="p">(</span><span class="n">engine</span><span class="o">=</span><span class="sh">"</span><span class="s">streaming</span><span class="sh">"</span><span class="p">))</span>
        <span class="k">case</span> <span class="sh">'</span><span class="s">.parquet</span><span class="sh">'</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pl</span><span class="p">.</span><span class="nf">scan_parquet</span><span class="p">(</span><span class="n">path1</span><span class="p">).</span><span class="nf">collect</span><span class="p">(</span><span class="n">engine</span><span class="o">=</span><span class="sh">"</span><span class="s">streaming</span><span class="sh">"</span><span class="p">).</span><span class="nf">equals</span><span class="p">(</span><span class="n">pl</span><span class="p">.</span><span class="nf">scan_parquet</span><span class="p">(</span><span class="n">path2</span><span class="p">).</span><span class="nf">collect</span><span class="p">(</span><span class="n">engine</span><span class="o">=</span><span class="sh">"</span><span class="s">streaming</span><span class="sh">"</span><span class="p">))</span>
        <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">filecmp</span><span class="p">.</span><span class="nf">cmp</span><span class="p">(</span><span class="n">path1</span><span class="p">,</span> <span class="n">path2</span><span class="p">,</span> <span class="n">shallow</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div><span class="meta"><time datetime="2025-08-06T00:00:00+01:00">August 6, 2025</time> &middot; <a href="/tag/files">files</a>, <a href="/tag/equal">equal</a>, <a href="/tag/equality">equality</a></span> <!--<span class="meta"><time datetime="2025-08-06T00:00:00+01:00">August 6, 2025</time> &middot; <a class="post" href="/tag/files">files</a>, <a class="post" href="/tag/equal">equal</a>, <a class="post" href="/tag/equality">equality</a></span> --></section></main></body></html>
